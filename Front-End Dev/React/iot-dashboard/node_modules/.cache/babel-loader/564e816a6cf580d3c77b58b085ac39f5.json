{"ast":null,"code":"var _jsxFileName = \"/Users/syukrirahiman/OneDrive - Singapore Management University/React/iot-test/src/components/analysis.js\";\nimport React, { Component } from 'react';\nimport 'firebase/database';\nimport * as firebase from 'firebase/app';\nimport { objectExpression } from '@babel/types';\nconst beaconlist = {\n  \"c2af522362be\": \"Client A\",\n  \"e20200bc8540\": \"Client B\"\n};\n\nclass Analysis extends React.Component {\n  constructor(props) {\n    super(props);\n    const beaconlist = {\n      \"c2af522362be\": \"Client A\",\n      \"e20200bc8540\": \"Client B\"\n    };\n    var self = this;\n    this.state = {\n      beaconlist: [{\n        id: \"c2af522362be\",\n        name: \"Client A\",\n        timeLeftHistory: [],\n        numberOfLeft: 0,\n        category: \"good\",\n        numberOfLeftDuringOperatingHours: 0\n      }, {\n        id: \"e20200bc8540\",\n        name: \"Client B\",\n        timeLeftHistory: [],\n        numberOfLeft: 0,\n        category: \"good\",\n        numberOfLeftDuringOperatingHours: 0\n      }],\n      thresholdCategory: [{\n        threshold: 0,\n        valueMsg: \"Low Risk\"\n      }, {\n        threshold: 1,\n        valueMsg: \"Medium Risk\"\n      }, {\n        threshold: 2,\n        valueMsg: \"High Risk\"\n      }],\n      data: '',\n      periodTracker: {\n        morning: 0,\n        noon: 0,\n        afternoon: 0,\n        nonOperatingHour: 0\n      }\n    }; // const rootRef = firebase.database().ref();\n    // const beaconRef = rootRef.child('deployment');\n    // const tableval = beaconRef.limitToLast(100).on('child_added',function(snapshot){\n    //     var data = snapshot.val();\n    //     console.log(data);\n    //     console.log(beaconlist[0]);\n    //     var beacon_1 = data[Object.keys(beaconlist)[0]];\n    //     var beacon_2 = data[Object.keys(beaconlist)[1]];\n    //     console.log(beacon_1);\n    //     self.setState({\n    //         beaconArray:[\n    //           { id: beacon_1.id,\n    //              lastSeen: beacon_1.lastSeen, \n    //              rssi_da1: beacon_1.rssi_da1, \n    //              lastSeen_da1: beacon_1.lastSeen_da1,\n    //              rssi_ma1: beacon_1.rssi_ma1,\n    //              last_seen_ma1: beacon_1.last_seen_ma1,\n    //              rssi_r1: beacon_1.rssi_r1,\n    //              last_seen_r1: beacon_1.last_seen_r1, \n    //              statusMsg: beacon_1.statusMsg },\n    //              { id: beacon_2.id,\n    //                 lastSeen: beacon_2.lastSeen, \n    //                 rssi_da1: beacon_2.rssi_da1, \n    //                 lastSeen_da1: beacon_2.lastSeen_da1,\n    //                 rssi_ma1: beacon_2.rssi_ma1,\n    //                 last_seen_ma1: beacon_2.last_seen_ma1,\n    //                 rssi_r1: beacon_2.rssi_r1,\n    //                 last_seen_r1: beacon_2.last_seen_r1, \n    //                 statusMsg: beacon_2.statusMsg }\n    //          ]\n    //     })\n    // }); \n  }\n\n  componentDidMount() {\n    var recentPostsRef = firebase.database().ref('/deployment');\n    recentPostsRef.once('value').then(snapshot => {\n      // snapshot.val() is the dictionary with all your keys/values from the '/store' path\n      this.setState({\n        data: snapshot.val()\n      }, () => {\n        this.generateClientData();\n      });\n    });\n  }\n\n  render() {\n    console.log(this.state);\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    });\n  } // renderTableHeader() {\n  //     let header = Object.keys(this.state.beaconArray)\n  //     return header.map((key, index) => {\n  //         return <th key={index}>{key.toUpperCase()}</th>\n  //     })\n  // }\n  // renderTableData() {\n  //     return this.state.beaconArray.map((beaconArray, index) => {\n  //         const { id, lastSeen, rssi_da1, lastSeen_da1, rssi_da2, lastSeen_da2, statusMsg } = beaconArray //destructuring\n  //         var d = JSON.parse(lastSeen)\n  //         var x = new Date(d);\n  //         console.log(x);\n  //         return (\n  //             <tr key={id}>\n  //                 <td>{beaconlist[id]}</td>\n  //                 <td>{id}</td>\n  //                 <td>{x.toString()}</td>\n  //                 <td>{statusMsg}</td>\n  //             </tr>\n  //         )\n  //     })\n  // }\n  // render() {\n  //     return (\n  //         <div>\n  //             <h1 id='title'>Client Monitoring Dashboard</h1>\n  //             <table id='beacon'>\n  //                 <tbody>\n  //                     {/* <tr>{this.renderTableHeader()}</tr> */}\n  //                     <tr>\n  //                         <th>Name</th>\n  //                         <th>ID</th>\n  //                         <th>Last Seen</th>\n  //                         <th>Status Message</th>\n  //                     </tr>\n  //                     {this.renderTableData()}\n  //                 </tbody>\n  //             </table>\n  //         </div>\n  //     )\n  // }\n\n\n  generateClientData() {\n    console.log(this.state.beaconlist);\n    var data = this.state.data;\n    var beaconlist = this.state.beaconlist;\n    var entries = Object.entries(data); // console.log(entries)\n    // var updateBeaconList = new Array();\n\n    for (let i = 0; i < entries.length; i++) {\n      // console.log(data[i]);\n      var data = entries[i][1]; // to geth the object of beacons and its value\n\n      console.log(data);\n\n      for (let j = 0; j < beaconlist.length; j++) {\n        console.log(data); //value of current beaconin the beaconlist\n\n        var beacon = beaconlist[j];\n        var currObj = {\n          id: beacon.id,\n          name: beacon.name,\n          timeLeftHistory: beacon.timeLeftHistory,\n          numberOfLeft: beacon.numberOfLeft,\n          category: beacon.category,\n          numberOfLeftDuringOperatingHours: beacon.numberOfLeftDuringOperatingHours\n        };\n        var beaconid = beacon.id;\n        console.log(beaconid);\n        var timeLeftHistory = beacon.timeLeftHistory; // array of timeLeftHistory\n\n        var noOfLeft = beacon.numberOfLeft; // var t = \"e20200bc8540\";\n        //value of beacon from data in firebase\n\n        var beaconData = data[beaconid];\n        console.log(beaconData);\n        var lastSeenData = beaconData.lastSeen;\n        var statusMsgData = beaconData.statusMsg;\n\n        if (!timeLeftHistory.includes(lastSeenData)) {\n          if (statusMsgData == \"left\") {\n            noOfLeft += 1;\n            timeLeftHistory.push(lastSeenData);\n            console.log(noOfLeft);\n            console.log(\"yes\");\n          }\n        }\n\n        currObj.timeLeftHistory = timeLeftHistory;\n        currObj.numberOfLeft = noOfLeft;\n        currObj.numberOfLeftDuringOperatingHours = noOfLeft;\n        console.log(currObj.numberOfLeft);\n        beaconlist[j] = currObj;\n      }\n    }\n\n    this.setState({\n      beaconlist: beaconlist\n    }, () => {\n      this.generatePeriodTrackerData();\n    });\n  }\n\n  generatePeriodTrackerData() {\n    var beaconlist = this.state.beaconlist;\n    var periodTracker = this.state.periodTracker;\n\n    for (let i = 0; i < beaconlist.length; i++) {\n      var beacon = beaconlist[i];\n      var timeLeftHistory = beacon.timeLeftHistory; // var numberOfLeftDuringOperatingHours = beacon.numberOfLeftDuringOperatingHours;\n\n      var numberOfLeftDuringNonOperatinghours = 0;\n\n      for (let j = 0; j < timeLeftHistory.length; j++) {\n        var datetimestr = JSON.parse(timeLeftHistory[j]);\n        var datetime = new Date(datetimestr);\n        var time = datetime.toLocaleTimeString();\n        console.log(time); //set opening and closing time\n\n        var closing = \"18:00:00\";\n        var closingDate = Date.parse(\"01/01/2011 \" + closing);\n        var opening = \"07:00:00\";\n        var openingDate = Date.parse(\"01/01/2011 \" + opening);\n        var noon = \"12:00:00\";\n        var noonDate = Date.parse('01/01/2011 ' + noon);\n        var afternoon = \"15:00:00\";\n        var afternoonDate = Date.parse(\"01/01/2011 \" + afternoon);\n        var timeDate = Date.parse(\"01/01/2011 \" + time);\n\n        if (timeDate >= openingDate && timeDate <= closingDate) {\n          if (timeDate < noonDate) {\n            periodTracker.morning += 1;\n          } else if (timeDate < afternoonDate) {\n            periodTracker.noon += 1;\n          } else {\n            periodTracker.afternoon += 1;\n          }\n        } else {\n          periodTracker.nonOperatingHour += 1;\n          numberOfLeftDuringNonOperatinghours += 1;\n        }\n      }\n\n      beacon.numberOfLeftDuringOperatingHours -= numberOfLeftDuringNonOperatinghours; //update their cateogry\n\n      if (beacon.numberOfLeftDuringOperatingHours < 1) {\n        beacon.category = \"Low Risk\";\n      } else if (beacon.numberOfLeftDuringOperatingHours < 2) {\n        beacon.category = \"Medium Risk\";\n      } else {\n        beacon.category = \"High Risk\";\n      }\n\n      beaconlist[i] = beacon;\n    }\n\n    this.setState({\n      periodTracker: periodTracker,\n      beaconlist: beaconlist\n    });\n  }\n\n}\n\nexport default Analysis;","map":{"version":3,"sources":["/Users/syukrirahiman/OneDrive - Singapore Management University/React/iot-test/src/components/analysis.js"],"names":["React","Component","firebase","objectExpression","beaconlist","Analysis","constructor","props","self","state","id","name","timeLeftHistory","numberOfLeft","category","numberOfLeftDuringOperatingHours","thresholdCategory","threshold","valueMsg","data","periodTracker","morning","noon","afternoon","nonOperatingHour","componentDidMount","recentPostsRef","database","ref","once","then","snapshot","setState","val","generateClientData","render","console","log","entries","Object","i","length","j","beacon","currObj","beaconid","noOfLeft","beaconData","lastSeenData","lastSeen","statusMsgData","statusMsg","includes","push","generatePeriodTrackerData","numberOfLeftDuringNonOperatinghours","datetimestr","JSON","parse","datetime","Date","time","toLocaleTimeString","closing","closingDate","opening","openingDate","noonDate","afternoonDate","timeDate"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport 'firebase/database';\nimport * as firebase from 'firebase/app'\nimport { objectExpression } from '@babel/types';\nconst beaconlist = { \"c2af522362be\": \"Client A\", \"e20200bc8540\": \"Client B\" }\nclass Analysis extends React.Component {\n    constructor(props) {\n        super(props)\n        const beaconlist = { \"c2af522362be\": \"Client A\", \"e20200bc8540\": \"Client B\" }\n        var self = this;\n\n        this.state = {\n            beaconlist: [\n                {\n                    id: \"c2af522362be\",\n                    name: \"Client A\",\n                    timeLeftHistory: [],\n                    numberOfLeft: 0,\n                    category: \"good\",\n                    numberOfLeftDuringOperatingHours: 0,\n                },\n                {\n                    id: \"e20200bc8540\",\n                    name: \"Client B\",\n                    timeLeftHistory: [],\n                    numberOfLeft: 0,\n                    category: \"good\",\n                    numberOfLeftDuringOperatingHours: 0,\n                }\n            ],\n\n            thresholdCategory: [\n                {\n                    threshold: 0,\n                    valueMsg: \"Low Risk\"\n                },\n                {\n                    threshold: 1,\n                    valueMsg: \"Medium Risk\"\n                },\n                {\n                    threshold: 2,\n                    valueMsg: \"High Risk\"\n                }\n            ],\n            data: '',\n            periodTracker: {\n                morning: 0,\n                noon: 0,\n                afternoon: 0,\n                nonOperatingHour: 0,\n\n            }\n        }\n\n       \n\n\n        // const rootRef = firebase.database().ref();\n        // const beaconRef = rootRef.child('deployment');\n        // const tableval = beaconRef.limitToLast(100).on('child_added',function(snapshot){\n        //     var data = snapshot.val();\n\n        //     console.log(data);\n        //     console.log(beaconlist[0]);\n        //     var beacon_1 = data[Object.keys(beaconlist)[0]];\n        //     var beacon_2 = data[Object.keys(beaconlist)[1]];\n        //     console.log(beacon_1);\n\n        //     self.setState({\n        //         beaconArray:[\n        //           { id: beacon_1.id,\n        //              lastSeen: beacon_1.lastSeen, \n        //              rssi_da1: beacon_1.rssi_da1, \n        //              lastSeen_da1: beacon_1.lastSeen_da1,\n        //              rssi_ma1: beacon_1.rssi_ma1,\n        //              last_seen_ma1: beacon_1.last_seen_ma1,\n        //              rssi_r1: beacon_1.rssi_r1,\n        //              last_seen_r1: beacon_1.last_seen_r1, \n        //              statusMsg: beacon_1.statusMsg },\n\n        //              { id: beacon_2.id,\n        //                 lastSeen: beacon_2.lastSeen, \n        //                 rssi_da1: beacon_2.rssi_da1, \n        //                 lastSeen_da1: beacon_2.lastSeen_da1,\n        //                 rssi_ma1: beacon_2.rssi_ma1,\n        //                 last_seen_ma1: beacon_2.last_seen_ma1,\n        //                 rssi_r1: beacon_2.rssi_r1,\n        //                 last_seen_r1: beacon_2.last_seen_r1, \n        //                 statusMsg: beacon_2.statusMsg }\n\n        //          ]\n\n        //     })\n\n        // }); \n\n\n    }\n    componentDidMount(){\n        var recentPostsRef = firebase.database().ref('/deployment');\n        recentPostsRef.once('value').then(snapshot => {\n            // snapshot.val() is the dictionary with all your keys/values from the '/store' path\n            this.setState({\n                data: snapshot.val()\n            }, () => {\n\n                this.generateClientData();\n            })\n        });\n\n    }\n\n    render() {\n\n        console.log(this.state)\n\n        return (\n\n            <div></div>\n\n        )\n\n    }\n    // renderTableHeader() {\n\n    //     let header = Object.keys(this.state.beaconArray)\n    //     return header.map((key, index) => {\n    //         return <th key={index}>{key.toUpperCase()}</th>\n    //     })\n    // }\n\n    // renderTableData() {\n\n    //     return this.state.beaconArray.map((beaconArray, index) => {\n    //         const { id, lastSeen, rssi_da1, lastSeen_da1, rssi_da2, lastSeen_da2, statusMsg } = beaconArray //destructuring\n    //         var d = JSON.parse(lastSeen)\n    //         var x = new Date(d);\n    //         console.log(x);\n\n    //         return (\n    //             <tr key={id}>\n    //                 <td>{beaconlist[id]}</td>\n    //                 <td>{id}</td>\n    //                 <td>{x.toString()}</td>\n    //                 <td>{statusMsg}</td>\n    //             </tr>\n    //         )\n    //     })\n    // }\n\n    // render() {\n    //     return (\n    //         <div>\n    //             <h1 id='title'>Client Monitoring Dashboard</h1>\n    //             <table id='beacon'>\n    //                 <tbody>\n    //                     {/* <tr>{this.renderTableHeader()}</tr> */}\n    //                     <tr>\n    //                         <th>Name</th>\n    //                         <th>ID</th>\n    //                         <th>Last Seen</th>\n    //                         <th>Status Message</th>\n    //                     </tr>\n    //                     {this.renderTableData()}\n    //                 </tbody>\n    //             </table>\n    //         </div>\n    //     )\n    // }\n\n    generateClientData() {\n        console.log(this.state.beaconlist);\n        var data = this.state.data;\n\n        var beaconlist = this.state.beaconlist;\n\n        var entries = Object.entries(data)\n\n\n\n\n        // console.log(entries)\n\n        // var updateBeaconList = new Array();\n\n        for (let i = 0; i < entries.length; i++) {\n            // console.log(data[i]);\n\n            var data = entries[i][1] // to geth the object of beacons and its value\n            console.log(data);\n\n\n            for (let j = 0; j < beaconlist.length; j++) {\n                console.log(data)\n\n                //value of current beaconin the beaconlist\n                var beacon = beaconlist[j];\n\n                var currObj = {\n                    id: beacon.id,\n                    name: beacon.name,\n                    timeLeftHistory: beacon.timeLeftHistory,\n                    numberOfLeft: beacon.numberOfLeft,\n                    category: beacon.category,\n                    numberOfLeftDuringOperatingHours: beacon.numberOfLeftDuringOperatingHours,\n                }\n\n                var beaconid = beacon.id;\n                console.log(beaconid)\n                var timeLeftHistory = beacon.timeLeftHistory; // array of timeLeftHistory\n\n                var noOfLeft = beacon.numberOfLeft;\n\n                // var t = \"e20200bc8540\";\n\n                //value of beacon from data in firebase\n                var beaconData = data[beaconid];\n                console.log(beaconData)\n                var lastSeenData = beaconData.lastSeen;\n                var statusMsgData = beaconData.statusMsg;\n\n                if (!(timeLeftHistory.includes(lastSeenData))) {\n                    if (statusMsgData == \"left\") {\n                        noOfLeft += 1;\n                        timeLeftHistory.push(lastSeenData);\n                        console.log(noOfLeft);\n                        console.log(\"yes\")\n                    }\n                }\n\n\n\n                currObj.timeLeftHistory = timeLeftHistory;\n                currObj.numberOfLeft = noOfLeft;\n                currObj.numberOfLeftDuringOperatingHours = noOfLeft;\n\n\n                console.log(currObj.numberOfLeft)\n\n                beaconlist[j] = currObj\n\n            }\n\n        }\n\n        this.setState({\n            beaconlist: beaconlist,\n        }, () => {\n            this.generatePeriodTrackerData();\n        })\n    }\n\n\n    generatePeriodTrackerData() {\n        var beaconlist = this.state.beaconlist;\n        var periodTracker = this.state.periodTracker;\n\n\n\n        for (let i = 0; i < beaconlist.length; i++) {\n            var beacon = beaconlist[i];\n            var timeLeftHistory = beacon.timeLeftHistory;\n            // var numberOfLeftDuringOperatingHours = beacon.numberOfLeftDuringOperatingHours;\n            var numberOfLeftDuringNonOperatinghours = 0;\n\n            for (let j = 0; j < timeLeftHistory.length; j++) {\n                var datetimestr = JSON.parse(timeLeftHistory[j]);\n                var datetime = new Date(datetimestr);\n                var time = datetime.toLocaleTimeString();\n                console.log(time)\n\n\n                //set opening and closing time\n                var closing = \"18:00:00\";\n                var closingDate = Date.parse(\"01/01/2011 \" + closing);\n                var opening = \"07:00:00\";\n                var openingDate = Date.parse(\"01/01/2011 \" + opening);\n\n                var noon = \"12:00:00\";\n                var noonDate = Date.parse('01/01/2011 ' + noon)\n                var afternoon = \"15:00:00\";\n                var afternoonDate = Date.parse(\"01/01/2011 \" + afternoon);\n\n                var timeDate = Date.parse(\"01/01/2011 \" + time);\n\n                if (timeDate >= openingDate && timeDate <= closingDate) {\n                    if (timeDate < noonDate) {\n                        periodTracker.morning += 1;\n                    } else if (timeDate < afternoonDate) {\n                        periodTracker.noon += 1;\n                    } else {\n                        periodTracker.afternoon += 1;\n                    }\n\n                } else {\n                    periodTracker.nonOperatingHour += 1;\n                    numberOfLeftDuringNonOperatinghours += 1\n\n                }\n            }\n\n\n            beacon.numberOfLeftDuringOperatingHours -= numberOfLeftDuringNonOperatinghours;\n\n            //update their cateogry\n            if (beacon.numberOfLeftDuringOperatingHours < 1) {\n                beacon.category = \"Low Risk\"\n            } else if (beacon.numberOfLeftDuringOperatingHours < 2) {\n                beacon.category = \"Medium Risk\"\n            } else {\n                beacon.category = \"High Risk\"\n            }\n\n            beaconlist[i] = beacon;\n\n        }\n\n        this.setState({\n            periodTracker: periodTracker,\n            beaconlist: beaconlist,\n        })\n    }\n\n}\n\nexport default Analysis"]},"metadata":{},"sourceType":"module"}